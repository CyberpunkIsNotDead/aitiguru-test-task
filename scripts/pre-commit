#!/bin/sh

# Pre-commit hook that runs linting and type checking
# Exit on any error
set -e

echo "üîç Running pre-commit checks..."

# Get staged files
STAGED_JS_TS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|jsx|ts|tsx)$')
STAGED_SCSS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(css|scss)$')

# Run TypeScript type checking if there are staged TS/TSX files
if [ -n "$STAGED_JS_TS" ]; then
    echo "Running TypeScript type checking..."
    npm run type-check
    if [ $? -ne 0 ]; then
        echo "‚ùå TypeScript type checking failed. Fix issues before committing."
        exit 1
    fi
fi

# Run ESLint only on JS/TS files
if [ -n "$STAGED_JS_TS" ]; then
    echo "Running ESLint on staged JS/TS files..."
    npx eslint $STAGED_JS_TS
    if [ $? -ne 0 ]; then
        echo "‚ùå ESLint failed. Fix issues before committing."
        exit 1
    fi
fi

# Run Stylelint only on CSS/SCSS files
if [ -n "$STAGED_SCSS" ]; then
    echo "Running Stylelint on staged CSS/SCSS files..."
    npx stylelint $STAGED_SCSS
    if [ $? -ne 0 ]; then
        echo "‚ùå Stylelint failed. Fix issues before committing."
        exit 1
    fi
fi

echo "‚úÖ All pre-commit checks passed!"
exit 0
